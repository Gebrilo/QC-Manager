# Report API Examples

## 1. Project Summary PDF

### Request

```http
POST /webhook/qc/reports/project-summary
Content-Type: application/json

{
  "project_id": "550e8400-e29b-41d4-a716-446655440000",
  "include_completed_tasks": true,
  "date_range": {
    "from": "2026-01-01",
    "to": "2026-01-18"
  }
}
```

### Successful Response

```json
{
  "success": true,
  "download_url": "https://qc-reports.s3.amazonaws.com/project-summary-550e8400-e29b-41d4-a716-446655440000-1737200400000.pdf?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=...&X-Amz-Signature=...",
  "filename": "project-summary-550e8400-e29b-41d4-a716-446655440000-1737200400000.pdf",
  "expires_in": 3600,
  "generated_at": "2026-01-18T10:00:00.000Z",
  "report_id": "RPT-LZ5K8M2N"
}
```

### Error Response (Project Not Found)

```json
{
  "success": false,
  "error": {
    "code": "PROJECT_NOT_FOUND",
    "message": "Project with ID '550e8400-e29b-41d4-a716-446655440000' not found or has been deleted."
  }
}
```

### Sample Output Filename

```
project-summary-550e8400-e29b-41d4-a716-446655440000-1737200400000.pdf
```

**Filename Pattern:** `project-summary-{project_id}-{timestamp}.pdf`

---

## 2. Task Export Excel

### Request

```http
POST /webhook/qc/reports/task-export
Content-Type: application/json

{
  "project_id": "550e8400-e29b-41d4-a716-446655440000",
  "status": ["completed", "pending"],
  "date_from": "2026-01-01",
  "date_to": "2026-01-18",
  "assignee": null
}
```

### Successful Response

```json
{
  "success": true,
  "download_url": "https://qc-reports.s3.amazonaws.com/task-export-1737200400000.xlsx?X-Amz-Algorithm=AWS4-HMAC-SHA256&...",
  "filename": "task-export-1737200400000.xlsx",
  "expires_in": 3600,
  "generated_at": "2026-01-18T10:00:00.000Z",
  "row_count": 47,
  "filters_applied": {
    "project_id": "550e8400-e29b-41d4-a716-446655440000",
    "status": ["completed", "pending"],
    "date_from": "2026-01-01",
    "date_to": "2026-01-18"
  }
}
```

### Request with All Filters

```http
POST /webhook/qc/reports/task-export
Content-Type: application/json

{
  "project_id": "550e8400-e29b-41d4-a716-446655440000",
  "status": ["pending", "in_progress", "failed"],
  "date_from": "2025-12-01",
  "date_to": "2026-01-18",
  "assignee": "john.doe@company.com"
}
```

### Sample Output Filename

```
task-export-1737200400000.xlsx
```

**Filename Pattern:** `task-export-{timestamp}.xlsx`

---

## 3. Scheduled Weekly Summary (No Request - Triggered by Schedule)

### Internal Workflow Payload (Generated by Schedule)

```json
{
  "trigger_type": "scheduled",
  "schedule": "weekly",
  "triggered_at": "2026-01-20T08:00:00.000Z",
  "scope": "all_active_projects"
}
```

### Workflow Output (Internal)

```json
{
  "reports_generated": 5,
  "reports": [
    {
      "project_id": "550e8400-e29b-41d4-a716-446655440000",
      "project_name": "Q1 Quality Audit",
      "filename": "weekly-summary-550e8400-1737360000000.pdf",
      "status": "success"
    },
    {
      "project_id": "661f9511-f39c-52e5-b827-557766551111",
      "project_name": "Manufacturing QC",
      "filename": "weekly-summary-661f9511-1737360000000.pdf",
      "status": "success"
    }
  ],
  "storage_location": "s3://qc-reports/scheduled/2026-01-20/",
  "notification_sent": true
}
```

---

## 4. Job Handling Pattern (Async Reports)

For large reports that take longer to generate, use async job handling:

### Request (Start Job)

```http
POST /webhook/qc/reports/project-summary
Content-Type: application/json

{
  "project_id": "550e8400-e29b-41d4-a716-446655440000",
  "async": true
}
```

### Response (Job Started)

```json
{
  "success": true,
  "job_id": "job_1737200400000_abc123",
  "status": "processing",
  "estimated_completion": "2026-01-18T10:00:30.000Z",
  "status_url": "/webhook/qc/reports/status/job_1737200400000_abc123"
}
```

### Poll Job Status

```http
GET /webhook/qc/reports/status/job_1737200400000_abc123
```

### Response (In Progress)

```json
{
  "job_id": "job_1737200400000_abc123",
  "status": "processing",
  "progress": 65,
  "started_at": "2026-01-18T10:00:00.000Z"
}
```

### Response (Completed)

```json
{
  "job_id": "job_1737200400000_abc123",
  "status": "completed",
  "download_url": "https://qc-reports.s3.amazonaws.com/project-summary-550e8400-...",
  "filename": "project-summary-550e8400-e29b-41d4-a716-446655440000-1737200400000.pdf",
  "expires_in": 3600,
  "completed_at": "2026-01-18T10:00:25.000Z"
}
```

---

## 5. Error Codes Reference

| Code | HTTP Status | Description |
|------|-------------|-------------|
| `PROJECT_NOT_FOUND` | 404 | The requested project does not exist or is deleted |
| `INVALID_DATE_RANGE` | 400 | date_from is after date_to |
| `INVALID_STATUS` | 400 | Unknown status value in filter |
| `NO_DATA` | 404 | No tasks match the filter criteria |
| `GENERATION_FAILED` | 500 | PDF/Excel generation service error |
| `STORAGE_ERROR` | 500 | Failed to upload to S3/Google Drive |
| `RATE_LIMITED` | 429 | Too many report requests |

---

## 6. Rate Limiting

| Endpoint | Limit |
|----------|-------|
| Project Summary PDF | 10 requests/minute per user |
| Task Export Excel | 20 requests/minute per user |
| Scheduled Reports | N/A (system-triggered) |

Reports exceeding limits receive:

```json
{
  "success": false,
  "error": {
    "code": "RATE_LIMITED",
    "message": "Rate limit exceeded. Please wait 60 seconds before retrying.",
    "retry_after": 60
  }
}
```
